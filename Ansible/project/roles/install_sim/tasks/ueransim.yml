---
- name: Fetch required dependencies
  block:
    - name: Fetch dependencies from apt
      ansible.builtin.apt:
        pkg:
        - dialog
        - apt-utils
        - build-essential
        - libsctp-dev
        - lksctp-tools
        - iproute2
        - g++
        update_cache: yes
        state: present
    - name: Fetch cmake from snap
      community.general.snap:
        name: cmake
        classic: true
- name: Clone UERANSIM git repo
  ansible.builtin.git:
    repo: "https://github.com/aligungr/UERANSIM"
    dest: "{{ clone_dest }}"
    clone: yes

- name: Compile the UERANSIM src code with Make
  community.general.make:
    chdir: "{{ clone_dest }}"
# Maybe this should be put into separate tasks file?
- name: Change the machine hostname
  ansible.builtin.hostname:
    name: "{{ inventory_hostname }}"

- name: Restart the machine
  ansible.builtin.reboot:
    pre_reboot_delay: 5 # Included due to a hang on restart (TODO test if it was one time occurence)
    reboot_timeout: 180 # Wait at most 3 minutes, otherwise it probably hung